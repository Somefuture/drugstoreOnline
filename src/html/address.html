<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- 视图窗口，移动端特属的标签。 -->
    <meta name="x5-orientation" content="portrait">
    <!-- UC强制全屏 -->
    <meta name="full-screen" content="yes">
    <!-- QQ强制全屏 -->
    <meta name="x5-fullscreen" content="true">
    <!-- UC应用模式 -->
    <meta name="browsermode" content="application">
    <!-- QQ应用模式 -->
    <meta name="x5-page-mode" content="app">
    <title>收货地址</title>
    <link rel="stylesheet" href="../css/normalize.css">
    <link type="text/css" rel="stylesheet" href="../css/swiper.css" />
    <link type="text/css" rel="stylesheet" href="../css/sweetalert.css" />
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/index.css">
</head>
<body>
<div class="shopping_header">
    <p class="title">收货地址</p>
    <span class="edit_btn" onclick="location='editAddress.html'">新增</span>
</div>
<div id="address"></div>
<div class="footer">
    <ul class="nav">
        <li>
            <a href="index.html">
                <img src="../images/tab/tab_32.png" alt="">
                首页
            </a>
        </li>
        <li>
            <a href="store.html">
                <img src="../images/tab/tab_36.png" alt="">
                精品商城
            </a>
        </li>
        <li>
            <a href="shoppingCar.html">
                <img src="../images/tab/tab_38.png" alt="">
                我的药箱
            </a>
        </li>
        <li>
            <a href="personal.html">
                <img src="../images/tab/tab_40.png" alt="">
                个人中心
            </a>
        </li>
    </ul>
</div>
</body>
<script type="text/template" id="address_template">
    <div class="address_body">
        <% if(address.length==0){ %>
        <div class="empty_address">
            <img src="../images/personal/personal_52.png" alt="">
            还未添加收货地址~
        </div>
        <% }else{ %>
        <ul class="address_lists">
            <% _.each(address,function(add){ %>
            <li>
                <div class="title">
                <span class="name">
                    <img src="../images/order/shopping_24.png" alt="">
                    <%= add.consignee %>
                </span>
                    <span class="phone">
                    <img src="../images/order/shopping_30.png" alt="">
                    <%= add.mobile %>
                </span>
                </div>
                <div class="address">
                    <img src="../images/order/shopping_27.png" alt="">
                    <p><%= add.provinceName %><%= add.suburbName %><%= add.unitDetail %></p>
                </div>
                <div class="edit_address">
                    <% if(add.default===true){ %>
                    <span class="default">
                            <img src="../images/shoppingcar/shopping_57.png" alt="">
                            默认地址
                        </span>
                    <% }else{ %>
                    <span class="default">
                        <img src="../images/shoppingcar/shopping_60.png" alt="">
                        设为默认
                        </span>
                    <% } %>
                    <span class="delete">
                    <img src="../images/personal/personal_20.png" alt="">
                    删除
                </span>
                    <span class="edit" onclick="location='editAddress.html'">
                    <img src="../images/personal/personal_23.png" alt="">
                    编辑
                </span>
                </div>
            </li>
            <% }) %>
        </ul>
        <% } %>
    </div>
</script>
<script src="../javascript/jquery-3.2.1.min.js"></script>
<script src="../javascript/sweetalert.min.js"></script>
<script src="../javascript/underscore-1.8.3.min.js"></script>
<script src="../javascript/util.js"></script>
<script>
    var address_template = _.template($("#address_template").html());
    get_address();
    function get_address() {
        $.ajax({
            url:"/user/addresses",
            headers: {"X-Requested-With": "h5"},
            success:function(json){
                if (json && json.error) {
                    swal("", json.error.message);
                } else {
                    $("#address").html(address_template({"address": json.success}));
                }
            },
            error:function (xhr, status, message) {
                if(message === "Unauthorized") {
                    window.location.href = "login.html";
                }else {
                    swal("", "系统繁忙，请稍后再试。");
                }
            }
        })
    }
</script>
</html>