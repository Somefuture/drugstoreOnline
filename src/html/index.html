<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- uc强制竖屏 -->
    <meta name="screen-orientation" content="portrait">
    <!-- QQ强制竖屏 -->
    <meta name="x5-orientation" content="portrait">
    <!-- UC强制全屏 -->
    <meta name="full-screen" content="yes">
    <!-- QQ强制全屏 -->
    <meta name="x5-fullscreen" content="true">
    <!-- UC应用模式 -->
    <meta name="browsermode" content="application">
    <!-- QQ应用模式 -->
    <meta name="x5-page-mode" content="app">
    <!-- windows phone 点击无高光 -->
    <meta name="msapplication-tap-highlight" content="no">
    <title>首页</title>
    <link rel="stylesheet" href="/css/normalize.css">
    <link type="text/css" rel="stylesheet" href="/css/swiper.css" />
    <link type="text/css" rel="stylesheet" href="/css/sweetalert.css" />
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/index.css">
</head>
<body>
<div class="index_body">
    <div class="header">
        <p>健康是一辈子的事业</p>
        <!--<div class="barcode">-->
        <!--<img src="/images/homePage/home_10@1x.png" alt="">-->
        <!--</div>-->
    </div>
    <div class="body">
        <div class="index_banner">
            <div class="top_color"></div>
            <div id="banner"></div>
        </div>
        <div id="notice"></div>
        <div class="quick">
            <div class="quick_shopping" onclick="location='/html/store.html'">
                <img src="/images/homePage/01.jpg" alt="">
            </div>
            <div class="knowledge">
                <img src="/images/homePage/02.jpg" alt="">
            </div>
        </div>
        <div id="reputation"></div>
        <div id="healthy"></div>
    </div>
    <div class="footer">
        <ul class="nav">
            <li class="active">
                <a href="">
                    <img src="/images/tab/tab_47.png" alt="">
                    首页
                </a>
            </li>
            <li>
                <a href="store.html">
                    <img src="/images/tab/tab_36.png" alt="">
                    精品商城
                </a>
            </li>
            <li>
                <a href="/html/shoppingCar.html">
                    <img src="/images/tab/tab_38.png" alt="">
                    我的药箱
                </a>
            </li>
            <li>
                <a href="personal.html">
                    <img src="/images/tab/tab_40.png" alt="">
                    个人中心
                </a>
            </li>
        </ul>
    </div>
</div>
</body>
<script type="text/template" id="banner_template">
    <div class="banner">
    <div class="swiper-container">
        <div class="swiper-wrapper">
            <% _.each(images, function (image) { %>
            <div class="swiper-slide">
                <!-- Required swiper-lazy class and image source specified in data-src attribute -->
                <img data-src="/file/public/<%= image.image.id %>.<%= image.image.ext %>" class="swiper-lazy"
                     <% if(image.module==="event"){ %>
                        onclick="location='<%= image.link %>'"
                    <% }else if(image.module==="product"){ %>
                        onclick="location='/html/productDetails.html?id=<%= image.moduleID %>'"
                    <% }else if(image.module==="info"){ %>
                        onclick="location='/html/healthy.html?id=<%= image.moduleID %>'"
                    <% }else{ %>
                        return;
                    <% } %>
                >
                <!-- Preloader image -->
                <div class="swiper-lazy-preloader swiper-lazy-preloader-white"></div>
            </div>
            <% }); %>
        </div>
        <!-- Add Pagination -->
        <div class="swiper-pagination swiper-pagination-white"></div>
    </div>
    </div>
</script>
<script type="text/template" id="notice_template">
    <div class="notice">
        <a href="/html/collection.html?id=2">
       <span class="icon">
           <img src="/images/homePage/home_33@2x.png" alt="">
           公告
       </span>
        <span class="content">
             <div>
                <%= notices[0].summary %>
            </div>
        </span>
        </a>
        <a href="/html/collection.html?id=2">
        <% _.each(_.rest(notices), function (notice) { %>
        <span class="content hide">
             <div onclick="location=url('/html/collection.html?id=2')">
                 <%= notice.summary %>
            </div>
        </span>
        <% }); %>
        </a>
    </div>
</script>
<script type="text/template" id="reputation_template">
    <div class="reputation">
        <div class="title">
             <img src="/images/homePage/home_45@1x.png" alt="" class="icon">
            <span class="title-content">口碑精选</span>
            <img src="/images/homePage/home_87.png" alt="" class="more" onclick="location='/html/store.html'">
        </div>
        <div class="repProduct">
            <div class="swiper-container2">
                <div class="swiper-wrapper">
                    <% _.each(images, function (image) { %>
                    <div class="swiper-slide">
                        <!-- Required swiper-lazy class and image source specified in data-src attribute -->
                        <div style="background-image: url('/file/public/<%= image.image.id %>.<%= image.image.ext %>')" class="swiper-lazy cover img"
                        <% if(image.module==="event"){ %>
                        onclick="location='<%= image.link %>'"
                        <% }else if(image.module==="product"){ %>
                        onclick="location='/html/productDetails.html?id=<%= image.moduleID %>'"
                        <% }else if(image.module==="info"){ %>
                        onclick="location='/html/healthy.html?id=<%= image.moduleID %>'"
                        <% }else{ %>
                        return;
                        <% } %> ></div>
                        <div class="describe">
                            <h4><%=image.title %></h4>
                            <p><%= image.summary %></p>
                        </div>
                    </div>
                    <% }); %>
                </div>
            </div>
        </div>
    </div>
</script>
<script type="text/template" id="healthy_template">
    <div class="healthy">
        <div class="title">
            <img src="/images/homePage/home_45@1x.png" alt="" class="icon">
            <span class="title-content">健康汇</span>
            <img src="/images/homePage/home_87.png" alt="" class="more" onclick="location='/html/healthyList.html'">
        </div>
        <ul class="articleList">
            <% _.each(list,function(art){ %>
            <li class="article" onclick="location='/html/healthy.html?id=<%= art.id %>'">
                <% if(art.cover.id===0){ %>
                <div style="background-image: url('/images/homePage/no_bg.png')" class="img cover"></div>
                <% }else{ %>
                <div class="img cover" style="background-image: url('/file/public/<%= art.cover.id %>.<%= art.cover.ext %>')"></div>
                <% } %>
                <div class="content">
                    <h2><%= art.title %><span class="new">new</span></h2>
                    <p class="describe"><%= art.summary %></p>
                    <div class="others">
                        <span class="type"><%= art.sectionName %></span>
                        <span class="date">
                    <% for(i=0 ; i < art.createAt.length;i++){
                            if(art.createAt[i]<10){
                            art.createAt[i]="0"+art.createAt[i];
                            }
                        } %>
                    <%=art.createAt[0]%>-<%=art.createAt[1]%>-<%=art.createAt[2]%>
                    </span>
                    </div>
                </div>
            </li>
            <% }); %>
        </ul>
    </div>
</script>
<script src="/javascript/jquery-3.2.1.min.js"></script>
<script src="/javascript/sweetalert.min.js"></script>
<script src="/javascript/swiper.min.js"></script>
<script src="/javascript/underscore-1.8.3.min.js"></script>
<script src="/javascript/util.js"></script>
<script>
    $(document).ready(function(){
        var width = $(window).width();
        var height = width * 340 / 645;

        $(".knowledge").click(function(){
            swal("","功能开发建设中");
        });

        render_banner();

        function render_banner() {
            ajax({
                url: "/advertisement/materials/by_collection",
                data: {"collectionID": 1},
                success: function (json) {
                    if(!json.error) {
                        var banner_template = _.template($("#banner_template").html());
                        $("#banner").html(banner_template({"images": json.success}));

                        $(".banner").height(height);

                        new Swiper('.swiper-container', {
                            slidesPerView: 1.2,
                            centeredSlides: true,
                            initialSlide: 1,//默认显示页
                            spaceBetween: 10,//slide之间的间距
                            slideToClickedSlide: true,
                            grabCursor: true,
                            loop:true,
                            mousewheel: {
                                enabled: true,
                            },
                            keyboard: {
                                enabled: true,
                            },
                            autoplay: {
                                delay: 2500
                            },
                            lazy: true,
                            pagination: {
                                el: '.swiper-pagination',
                                clickable: true
                            }
                        });

                        $("img.swiper-lazy").each(function () {
                            $(this).width(width);
                            $(this).height(height);
                        });
                        $("img.swiper-lazy").each(function () {
                            $(this).width(width);
                            $(this).height(height);
                        });
                    }
                }
            });
        }

        get_notice();

        function get_notice(){
            ajax({
                url: "/advertisement/materials/by_collection",
                data: {"collectionID": 2},
                success: function (json) {
                    if (json && json.error) {

                    } else {
                        var notice_template = _.template($("#notice_template").html());
                        $("#notice").html(notice_template({"notices": json.success}));
                        setInterval(function(){
                            var the_one = $('#notice .content').first();
                            the_one.clone(true).addClass("hide").appendTo('.notice');
                            the_one.remove();
                            $('#notice .content').first().removeClass("hide");
                        },3000);
                    }
                }
            });
        }

        get_reputation();

        function get_reputation() {
            ajax({
                url: "/advertisement/materials/by_collection",
                data: {"collectionID": 3},
                success: function (json) {
                    if(json && json.error) {

                    }else {
                        var reputation_template = _.template($("#reputation_template").html());
                        $("#reputation").html(reputation_template({"images": json.success}));
                        new Swiper('.swiper-container2', {
                            slidesPerView: 2.1,
                            initialSlide: 0,//默认显示页
                            spaceBetween: 10,//slide之间的间距
                            slideToClickedSlide: true,
                            grabCursor: true,
                            lazy: true
                        });
                    }
                }
            });
        }
        get_healthy();
        function get_healthy(){
            ajax({
                url: "/topics",
                data: {
                    bbsCode:"JKH",
                    drop:0,
                    take:5
                },
                success: function (json) {
                    if(json && json.error) {

                    }else {
                        var healthy_template = _.template($("#healthy_template").html());
                        $("#healthy").html(healthy_template({"list": json.success.list}));
                    }
                }
            });
        }
    });
</script>
</html>