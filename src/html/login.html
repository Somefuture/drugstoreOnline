<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
		<title>登陆</title>
		<link rel="stylesheet" type="text/css" href="/css/login.css"/>
		<link rel="stylesheet" type="text/css" href="/css/sweetalert.css"/>
	</head>
	<body>
		<div class="lo-img">
			<img src="/images/imgs/logo.png" />
		</div>
		<div class="lo-ipt-box" id="user_form">
			<div class="lo-ipt div-flex">
				<img src="/images/imgs/user.png" />
				<input type="text" id="username" placeholder="用户名"/>
			</div>
			<div class="lo-ipt div-flex">
				<img src="/images/imgs/pwd.png" />
				<input type="password" id="password" placeholder="密码"/>
			</div>
			<button id="login">登 录</button>
			<div class="lo-more div-flex">
				<div class="one-flex align-l">
					<span id="register">注册新用户</span>
				</div>
				<div class="one-flex align-r">
					<span id="forget_password">忘记密码？</span>
				</div>
			</div>
		</div>
	</body>
	<script src="/javascript/jquery-3.2.1.min.js"></script>
	<script src="/javascript/sweetalert.min.js"></script>
	<script src="/javascript/util.js"></script>
	<script>
		$(document).ready(function () {

            var show_swal = false;
            var redirect_uri = get_query_string("r");

            $("#register").click(function () {
                window.location.href = "/html/register.html" + (redirect_uri ? ("?r=" + escape(redirect_uri)) : "");
            });

            $("#forget_password").click(function () {
                window.location.href = "/html/changePassword.html" + (redirect_uri ? ("?r=" + escape(redirect_uri)) : "");
            });

            function login() {
                var username = $("#username").val();
                var password = $("#password").val();
                if (!username) {
                    show_swal = true;
                    swal("", "请输入手机号码");
                } else if (!password) {
                    show_swal = true;
                    swal("", "请输入登录密码");
                }else if(username.length!==11){
                    show_swal = true;
                    swal("", "请输入11位手机号");
                } else if(password.length<6){
                    show_swal = true;
                    swal("", "密码输入有误");
                }else {
                    ajax({
                        type: "post",
                        url: "/account/mobile/signin",
                        data: {"mobile": username, "password": password},
                        success: function (json) {
                            if(!json.error){
                                if(redirect_uri) {
                                    window.location.href = redirect_uri;
                                }else {
                                    window.location.href = "index.html";
                                }
                            }
                        }
                    });
                }
            }

            $("#login").click(login);

            $("#user_form").keyup(function (e) {
                if(Number(e.keyCode) === 13) {
                    if(show_swal) {
                        show_swal = false;
                    }else {
                        login();
                    }
                }
            })
        });

	</script>
</html>
